#!/bin/bash
# LLVMFuzzerTestOneInput for fuzzer detection.
this_dir=$(dirname "$0")
if [[ "$@" =~ (^| )-runs=[0-9]+($| ) ]]; then
  mem_settings='-Xmx1900m:-Xss900k'
else
  mem_settings='-Xmx2048m:-Xss1024k'
fi
JAVA_HOME="$this_dir/open-jdk-17/" LD_LIBRARY_PATH="$this_dir/open-jdk-17/lib/server":$this_dir $this_dir/jazzer_driver --agent_path=$this_dir/jazzer_agent_deploy.jar --cp=$this_dir/lucene-analysis-common.jar:$this_dir/lucene-core.jar:$this_dir/lucene-queryparser.jar::$this_dir --target_class=IndexSearchFuzzer --jvm_args="$mem_settings" $@
